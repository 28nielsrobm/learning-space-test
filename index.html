<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Learning Space</title>
  <link rel="icon" href="data:,">
  <style>
    body {
      background-color: #111;
      margin: 0;
      height: 100vh;
      overflow: hidden;
      font-family: sans-serif;
      color: white;
    }

    .game-area {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 600px;
      height: 600px;
      background-color: #222;
      border: 3px solid #000;
      z-index: 9999;
    }

    input[type="range"] {
      width: 200px;
    }

    input[type="range"]:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    #saveButton {
      position: fixed;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 16px;
      font-weight: bold;
      z-index: 15000;
      cursor: pointer;
    }

    .player {
      position: absolute;
      width: 40px;
      height: 40px;
    }

    .coin {
      position: absolute;
      width: 30px;
      height: 30px;
      background-color: gold;
      border-radius: 50%;
    }

    .label {
      position: absolute;
      font-weight: bold;
    }

    .menu {
      position: fixed;
      inset: 0;
      background: #111;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 20000;
    }

    .menu-options,
    .menu-sliders {
      margin: 12px 0;
      text-align: center;
    }

    .menu button {
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
    }

    .game-over {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 30000;
      text-align: center;
    }

    /* === PAUSE MENU === */
    .pause-menu {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 25000;
      text-align: center;
    }

    .pause-menu button {
      margin-top: 16px;
      padding: 10px 24px;
      font-size: 18px;
      cursor: pointer;
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>

<!-- ===== MENU ===== -->
<div id="menu" class="menu">
  <h1>Learning Space</h1>

  <div class="menu-options">
    <label><input type="radio" name="mode" value="1" checked> Single Player</label>
    <label><input type="radio" name="mode" value="2"> Two Players</label>
  </div>

  <div class="menu-sliders">
    Player 1 Speed:
    <input type="range" id="menuSpeed1" min="1" max="10">
    <br><br>
    Player 2 Speed:
    <input type="range" id="menuSpeed2" min="1" max="10">
  </div>

  <button id="startButton">Start Game</button>
</div>

<button id="saveButton" class="hidden">Save Now</button>

<!-- ===== PAUSE MENU ===== -->
<div id="pauseMenu" class="pause-menu hidden">
  <h1>Paused</h1>
  <button id="resumeButton">Resume</button>
  <button id="pauseToMenu">Back to Menu</button>
</div>

<!-- ===== GAME OVER ===== -->
<div id="gameOverScreen" class="game-over hidden">
  <h1>Game Over</h1>
  <p id="finalScore1"></p>
  <p id="finalScore2"></p>
  <p id="finalHighScore1"></p>
  <p id="finalHighScore2"></p>
  <button id="gameOverReplay">Replay</button>
</div>

<script>
const GAME_SIZE = 600;
const PLAYER_SIZE = 40;
const COIN_SIZE = 30;

let gameOver = false;
let paused = false; // === PAUSE STATE ===
let timeLeft = 60;
let timerInterval;
let gameMode = 1;

/* ELEMENTS */
const menu = document.getElementById('menu');
const pauseMenu = document.getElementById('pauseMenu');
const resumeButton = document.getElementById('resumeButton');
const pauseToMenu = document.getElementById('pauseToMenu');
const saveButton = document.getElementById('saveButton');
const startButton = document.getElementById('startButton');
const menuSpeed1 = document.getElementById('menuSpeed1');
const menuSpeed2 = document.getElementById('menuSpeed2');
const modeButtons = document.getElementsByName('mode');

const gameOverScreen = document.getElementById('gameOverScreen');
const gameOverReplay = document.getElementById('gameOverReplay');

let score1 = 0, score2 = 0;
let highScore1 = Number(localStorage.getItem('highScore1')) || 0;
let highScore2 = Number(localStorage.getItem('highScore2')) || 0;
let step1 = Number(localStorage.getItem('player1Speed')) ?? 3;
let step2 = Number(localStorage.getItem('player2Speed')) ?? 3;

/* GAME AREA */
const gameArea = document.createElement('div');
gameArea.className = 'game-area';
document.body.appendChild(gameArea);

function createPlayer(color, x, y) {
  const p = document.createElement('div');
  p.className = 'player';
  p.style.backgroundColor = color;
  p.style.left = x + 'px';
  p.style.top = y + 'px';
  return p;
}

const player1 = createPlayer('#ff4d4d', 100, 180);
const player2 = createPlayer('#4d4dff', 450, 180);
gameArea.append(player1, player2);

/* LABELS */
function makeLabel(text, top, left) {
  const el = document.createElement('div');
  el.className = 'label';
  el.textContent = text;
  el.style.top = top;
  el.style.left = left;
  gameArea.appendChild(el);
  return el;
}

const scoreDisplay1 = makeLabel('Score: 0', '5px', '5px');
const scoreDisplay2 = makeLabel('Score: 0', '5px', '500px');
const timerDisplay = makeLabel('Time: 60', '5px', '50%');
timerDisplay.style.transform = 'translateX(-50%)';

const player2UI = [player2, scoreDisplay2];

/* COINS */
let coins = [];
function spawnCoin() {
  const c = document.createElement('div');
  c.className = 'coin';
  c.style.left = Math.random() * (GAME_SIZE - COIN_SIZE) + 'px';
  c.style.top = Math.random() * (GAME_SIZE - COIN_SIZE) + 'px';
  gameArea.appendChild(c);
  coins.push(c);
}
for (let i = 0; i < 10; i++) spawnCoin();

/* INPUT */
const keys = {};
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') togglePause();
  keys[e.key] = true;
});
document.addEventListener('keyup', e => keys[e.key] = false);

/* GAME LOOP */
function gameLoop() {
  if (!gameOver && !paused) {
    movePlayer(player1, step1, 'w','s','a','d');
    checkCollision(player1, 1);
    if (gameMode === 2) {
      movePlayer(player2, step2,'ArrowUp','ArrowDown','ArrowLeft','ArrowRight');
      checkCollision(player2, 2);
    }
  }
  requestAnimationFrame(gameLoop);
}

/* TIMER */
function startTimer() {
  timerInterval = setInterval(() => {
    if (!paused) {
      timeLeft--;
      timerDisplay.textContent = `Time: ${timeLeft}`;
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        gameOver = true;
        gameOverScreen.classList.remove('hidden');
      }
    }
  }, 1000);
}

/* === PAUSE LOGIC === */
function togglePause() {
  if (menu.classList.contains('hidden') &&
      gameOverScreen.classList.contains('hidden')) {
    paused = !paused;
    pauseMenu.classList.toggle('hidden', !paused);
  }
}

resumeButton.onclick = () => {
  paused = false;
  pauseMenu.classList.add('hidden');
};

pauseToMenu.onclick = () => {
  paused = false;
  pauseMenu.classList.add('hidden');
  menu.classList.remove('hidden');
  saveButton.classList.add('hidden');
  clearInterval(timerInterval);
};

/* MENU */
function updatePlayer2UI() {
  const single = gameMode === 1;
  menuSpeed2.disabled = single;
  player2UI.forEach(el => el.classList.toggle('hidden', single));
}

modeButtons.forEach(rb => {
  rb.addEventListener('change', () => {
    gameMode = Number(rb.value);
    updatePlayer2UI();
  });
});

startButton.onclick = () => {
  step1 = Number(menuSpeed1.value);
  step2 = Number(menuSpeed2.value);
  menu.classList.add('hidden');
  saveButton.classList.remove('hidden');
  updatePlayer2UI();
  startTimer();
  requestAnimationFrame(gameLoop);
};

gameOverReplay.onclick = () => location.reload();

/* INIT */
(async () => {
  menuSpeed1.value = step1;
  menuSpeed2.value = step2;
  updatePlayer2UI();
})();
</script>
</body>
</html>
